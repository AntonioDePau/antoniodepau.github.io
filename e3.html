<html>
	<head>
	<title>E3 2017</title>
	<style>
	body{
	background-image: url(http://www.actugaming.net/wp-content/uploads/2017/05/E3-2017.png);
	background-size: 100% 100%;
	vertical-align:middle;
    text-align: center;
	}
	table {
	border-collapse: collapse;
	border-radius: 10px;
	margin-top: 50px;
	//margin-left:160px;
	}
	th, td {
	background-color: rgba(255, 255, 255, .85);
	//color: rgba(255, 255, 255, .5);
	color: black;
	padding: 5px;
    border: 1px solid black;
    border-collapse: collapse;
	}
	
	img {
	max-height: 50px;
	max-width: 50px;
	}
	
	tr > td:last-child {
	text-align:center;
	}
</style>
	</head>
	
	<body style="">
	<div style="width:auto;margin:50 auto auto 35;display: inline-block;vertical-align:middle">
		<table id="table">
		<tr>
			<td style="border: none; background-color: rgba(255, 255, 255,0);color: rgba(255,255,255,0);"></td>
			<th>Jour</th>
			<th>Temps restant</th>
			<th>Visionner sur</th>
		</tr>		
		</table>
	</div>
	</body>
</html>

<script>
var alert = new Audio('alert.mp3');

var yt_logo = "https://www.youtube.com/yt/brand/media/image/YouTube-icon-full_color.png";
var tw_logo = "https://i.warosu.org/data/g/img/0488/82/1436268496494.png";

var streams = {
"ea": {
"name":"Electronic Arts",
"date":new Date("Jun 10, 2017 21:00:00"),
"yt":"https://www.youtube.com/watch?v=P9BB0ambDQw",
"tw":"https://www.twitch.tv/ea"
},
"xb": {
"name":"Xbox",
"date":new Date("Jun 11, 2017 23:00:00"),
"tw":"https://www.twitch.tv/xbox",
"yt":"https://www.youtube.com/watch?v=dZ4GpE3c97U"
},
"beth": {
"name":"Bethesda",
"date":new Date("Jun 12, 2017 06:00:00"),
"tw":"https://www.twitch.tv/bethesda",
"yt":"https://www.youtube.com/watch?v=gbslVwy0XzY"
},
"dev": {
"name":"Devolver",
"date":new Date("Jun 12, 2017 07:00:00"),
"tw":"https://www.twitch.tv/devolverdigital"
},
"pc": {
"name":"PC gaming show",
"date":new Date("Jun 12, 2017 19:00:00"),
"tw":"https://www.twitch.tv/pcgamer"
},
"ubi": {
"name":"Ubisoft",
"date":new Date("Jun 12, 2017 22:00:00"),
"tw":"https://www.twitch.tv/ubisoft"
},
"ps": {
"name":"Playstation",
"date":new Date("Jun 13, 2017 03:00:00"),
"tw":"https://www.twitch.tv/playstation"
},
"nd": {
"name":"Nintendo Direct",
"date":new Date("Jun 13, 2017 18:00:00"),
"tw":"https://www.twitch.tv/nintendo"
}
};

function formatDate(date) {
  var dayNames = ["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"];
  var dayIndex = date.getDay();
  var day = date.getDate();
  var hour = date.getHours();
  return dayNames[dayIndex] +" "+ day +" à "+ hour +"h";
}

var interval = function(obj){
	var x = setInterval(function() {
		count(obj, streams[obj].date);
	}, 1000);
};

for (var i = 0; i < Object.keys(streams).length; i++){
    var obj = Object.keys(streams)[i];
	var table = document.getElementById("table");
	table.innerHTML = table.innerHTML + '<tr><td id="'+obj+'">'+streams[obj].name+'</td><td id="'+obj+'_date"></td><td id="'+obj+'_heure"></td><td id="'+obj+'_stream"></td></tr>';	
	var stream = document.getElementById(obj+"_stream");
	var date = document.getElementById(obj+"_date");
		if (streams[obj].date && streams[obj].date !== ""){
		date.innerHTML = formatDate(streams[obj].date);
		}
		if (streams[obj].yt && streams[obj].yt !== ""){
	    stream.innerHTML = '<a target="_blank" href="'+streams[obj].yt+'"><img style="max-height:25px;" src="'+yt_logo+'"></a>';
		}
		if (streams[obj].tw && streams[obj].tw !== ""){
		stream.innerHTML = stream.innerHTML + '<a target="_blank" href="'+streams[obj].tw+'"><img src="'+tw_logo+'"></a><br>';
		}
		interval(obj);
}


var count = function(Conf, datet){
var now = new Date().getTime();
  var distance = datet - now;
  var days = Math.floor(distance / (1000 * 60 * 60 * 24));
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  document.getElementById(Conf+"_heure").innerHTML = days + "j " + hours + "h "
  + minutes + "m " + seconds + "s";
  if (distance < (60*30)*1000 && distance > 0) {
	alarm(Conf);
    document.getElementById(Conf+"_heure").style.color = "red";
    document.getElementById(Conf+"_heure").style.fontWeight = "bold";
  }
  if (distance < 0) {
    document.getElementById(Conf+"_heure").innerHTML = "Conférence débutée";
  }
}

var countAl = [];

var alarm = function(Conf){
	if (countAl.indexOf(Conf) == -1){
	alert.play();
	console.log(Conf);
	countAl.push(Conf);
	}
}
</script>